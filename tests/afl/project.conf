targets=config,variable,test-config,test-variable
cppflags_force=-I ../../include
#XXX does not work on macOS
ldflags_force=-static
cc=afl-gcc
dist=Makefile,config-input/config.conf

#targets
[config]
type=binary
sources=config.c

[test-config]
type=command
command=afl-fuzz -i config-input -o config-output -- $(OBJDIR)config @@
depends=$(OBJDIR)config,config-input/config.conf
phony=1
enabled=0

[test-variable]
type=command
command=afl-fuzz -i ../variable-samples -o variable-output -- $(OBJDIR)variable
depends=$(OBJDIR)variable
phony=1
enabled=0

[variable]
type=binary
sources=variable.c

#sources
[config.c]
depends=../../src/array.c,../../src/config.c,../../src/error.c,../../src/hash.c,../../src/mutator.c,../../src/object.c,../../src/string.c

[variable.c]
depends=../../src/array.c,../../src/buffer.c,../../src/error.c,../../src/object.c,../../src/string.c,../../src/variable.c
